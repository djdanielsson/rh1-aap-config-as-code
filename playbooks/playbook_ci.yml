---
# AAP Configuration-as-Code Main Playbook
# Applies declarative configuration to AAP environments
# Uses: infra.aap_configuration collection with dispatch role

- name: Configure Ansible Automation Platform
  hosts: localhost
  connection: local
  gather_facts: false

  vars:
    # Enable validation and diff output
    controller_configuration_async_retries: 60
    controller_configuration_async_delay: 2

    # Dispatch role configuration
    # Enable wildcard variable matching for better organization
    dispatch_include_wildcard_vars: true
    redhat_subscription_username: 45493b0f-58ea-40bd-bd66-f6b6e1b6d1cf
    redhat_subscription_password: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      32363235663461313832313266343130653538303830323833653931666534313033663037333763
      3361653961383537323532363566303730353566386235620a653863663865363164306130376263
      62353033383264376634353065613766346233643561396162663730353964396632396463653863
      6661323130323636610a333931383234386531326635643339303433633132623364336239633532
      38393265643837616161373437346635643136666238363336656662333965636534333361383636
      3933376363386261393365323234643034613136333761623133
    controller_license:
      use_lookup: true
      filters:
        product_name: "Red Hat Ansible Automation Platform"
        support_level: "Self-Support"

  tasks:
    - name: Apply license to AAP
      ansible.builtin.include_role:
        name: infra.aap_configuration.controller_license

    # Use dispatch role to automatically apply all configurations
    # The dispatch role handles proper ordering and dependency management
    - name: Apply AAP configuration using dispatch role
      ansible.builtin.include_role:
        name: infra.aap_configuration.dispatch
      vars:
        # Enable wildcard variable matching
        # This allows variables like:
        #   - controller_job_templates_web
        #   - controller_job_templates_database
        #   - controller_projects_platform
        #   - controller_projects_apps
        # to be automatically merged into their base variables
        dispatch_include_wildcard_vars: true
      tags: always
...
