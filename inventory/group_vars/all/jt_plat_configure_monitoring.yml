---
# jt_plat_configure_monitoring.yml
# Platform organization monitoring configuration
# Contains: EE + Project + JT (tightly coupled resources)
#
# RELEASE VERSIONING:
# The promote pipeline updates scm_branch and image tags based on the release manifest.
#
# Version mapping in release manifest:
#   version_mappings.jt_plat_configure_monitoring.project_version
#   version_mappings.jt_plat_configure_monitoring.ee_version

# Execution Environment
controller_execution_environments_plat_configure_monitoring:
  - name: "plat_monitoring_ee_{{ jt_plat_configure_monitoring | default(ee_image) }}"
    description: "Platform monitoring and observability execution environment"
    image: "quay.io/myorg/custom-ee:{{ jt_plat_configure_monitoring | default(ee_image) }}"
    pull: "missing"
    credential: "plat_registry_svc_builder_quay_io"

# Project
controller_projects_plat_configure_monitoring:
  - name: "plat_monitoring_config_playbooks"
    description: "Platform monitoring configuration playbooks"
    scm_type: git
    scm_url: "https://github.com/djdanielsson/rh1-automation-playbooks.git"
    scm_branch: "{{ jt_plat_configure_monitoring | default(scm_branch) }}"
    scm_clean: true
    scm_delete_on_update: true
    scm_update_on_launch: false
    credential: "plat_scm_djdanielsson_github"
    timeout: 0
    organization: "platform"

# Job Template
controller_templates_plat_configure_monitoring:
  - name: "plat_configure_monitoring_{{ env }}"
    description: "Configure monitoring agents on {{ env }} servers"
    job_type: "run"
    inventory: "plat_linux_{{ env }}"
    project: "plat_monitoring_config_playbooks"
    playbook: "playbooks/configure-monitoring.yml"
    execution_environment: "plat_monitoring_ee_{{ jt_plat_configure_monitoring | default(ee_image) }}"
    credentials:
      - "plat_machine_svc_ansible_linux"
    organization: "platform"
    ask_variables_on_launch: true
    extra_vars:
      monitoring_config: "{{ env }}"
...
